<template>
  <header class="header" :class="{'header-shop':toShop}">
    <h1 class="logo">
      <a href="/">
        <svg width="100%" height="100%" xmlns="http://www.w3.org/2000/svg" viewBox="10 0 97.179 34.328">
          <g>
            <title>と音楽 &amp;MUSIC</title>
            <g>
              <g>
                <path d="M67.976,2.081h-8.998V0h-5.52v2.081h-8.998v2.345h3.272l-1.294,5.44h-1.977v2.345h23.515V9.866h-1.974l-1.293-5.44h3.267V2.081z M59.832,9.866h-7.227v-5.44h7.227V9.866z"></path>
                <g>
                  <path d="M65.765,13.516H46.672l-1.014,10.371h21.122L65.765,13.516z M59.994,21.949h-7.551v-2.267h7.551V21.949zM59.994,17.722h-7.551v-2.267h7.551V17.722z"></path>
                </g>
              </g>
              <g>
                <polygon points="87.57,19.713 89.935,23.887 96.37,23.887 91.741,19.713"></polygon>
                <g>
                  <polygon points="96.209,3.324 92.801,3.324 90.609,7.505 92.477,12.98 97.179,12.98 94.664,7.505"></polygon>
                  <polygon points="74.484,3.324 71.076,3.324 72.62,7.505 70.105,12.98 74.807,12.98 76.675,7.505"></polygon>
                  <g>
                    <path d="M86.402,16.013v-1.305h4.314L89.098,2.081h-3.02V0h-4.873v2.081h-3.02l-1.618,12.627h4.314v1.305h-9.968v2.345h6.183l-6.183,5.529h6.435l3.533-4.954v4.954h5.52v-5.529h9.968v-2.345H86.402z M85.251,11.359h-3.218v-1.79h3.218V11.359z M85.251,7.51h-3.218V5.72h3.218V7.51z"></path>
                  </g>
                </g>
              </g>
              <path d="M32.865,20.461c-0.498-0.132-0.89-0.481-0.859-1.008c0.038-0.645,0.414-1.046,1.329-1.466c2.09-0.959,8.503-2.17,8.503-2.17l-0.401-2.456c0,0-2.917,0.344-5.202,0.6l-2.105-5.214l-2.997,0.361l0.43,5.696c-0.642,0.215-1.499,0.67-1.899,0.987c-1.133,0.897-1.715,2.218-1.715,3.628c0,1.711,0.888,3.116,2.376,3.811c1.05,0.486,2.772,0.658,5.614,0.658l5.9-0.116v-3.337C36.855,20.657,33.861,20.724,32.865,20.461z"></path>
            </g>
            <g>
              <path d="M18.274,34.186v-4.087h-1.199v-1.265h3.857v1.265h-1.199v4.087H18.274z"></path>
              <path d="M21.644,34.186v-5.352h1.525c0.597,0,1.013,0.027,1.248,0.082c0.235,0.055,0.438,0.147,0.609,0.276c0.193,0.146,0.341,0.333,0.444,0.559c0.103,0.227,0.155,0.476,0.155,0.749c0,0.415-0.102,0.751-0.305,1.011c-0.204,0.259-0.5,0.432-0.89,0.517l1.459,2.157H24.24l-1.228-2.095v2.095H21.644z M23.012,31.363h0.271c0.314,0,0.544-0.054,0.689-0.161c0.145-0.107,0.218-0.275,0.218-0.505c0-0.268-0.068-0.459-0.203-0.572c-0.135-0.113-0.363-0.17-0.682-0.17h-0.293V31.363z"></path>
              <path d="M25.816,34.186l1.846-5.352h1.828l1.85,5.352h-1.451l-0.27-0.958h-2.073l-0.278,0.958H25.816zM27.859,32.186h1.451l-0.545-1.766c-0.017-0.054-0.04-0.14-0.07-0.26c-0.029-0.119-0.067-0.273-0.113-0.461c-0.032,0.132-0.063,0.257-0.093,0.377s-0.061,0.234-0.093,0.344L27.859,32.186z"></path>
              <path d="M32.896,34.186l-2.245-5.352h1.55l1.071,2.994c0.01,0.032,0.03,0.108,0.06,0.228c0.03,0.121,0.07,0.283,0.119,0.488c0.039-0.163,0.076-0.311,0.11-0.443c0.034-0.131,0.06-0.223,0.077-0.274l1.064-2.994h1.55l-2.245,5.352H32.896z"></path>
              <path d="M36.687,34.186v-5.352h3.279v1.173h-1.857v0.929h1.751v1.148h-1.751v0.903h1.857v1.199H36.687z"></path>
              <path d="M40.931,34.186v-5.352h1.459v4.102h1.813v1.25H40.931z"></path>
              <path d="M50.947,34.186l-0.472-0.548c-0.256,0.239-0.525,0.414-0.808,0.525s-0.597,0.166-0.943,0.166c-0.475,0-0.863-0.139-1.164-0.419c-0.301-0.279-0.451-0.637-0.451-1.073c0-0.336,0.099-0.633,0.296-0.89c0.197-0.257,0.513-0.499,0.947-0.726c-0.168-0.193-0.293-0.38-0.375-0.561c-0.082-0.182-0.123-0.361-0.123-0.539c0-0.358,0.141-0.657,0.422-0.898c0.281-0.24,0.635-0.36,1.062-0.36c0.487,0,0.871,0.118,1.152,0.355c0.28,0.236,0.42,0.557,0.42,0.961c0,0.258-0.076,0.499-0.228,0.724c-0.152,0.224-0.381,0.433-0.685,0.625l0.629,0.658c0.124-0.102,0.249-0.215,0.373-0.336c0.124-0.122,0.25-0.257,0.377-0.406l0.764,0.786c-0.127,0.156-0.25,0.296-0.371,0.421c-0.121,0.124-0.242,0.236-0.364,0.336l1.162,1.199H50.947z M49.745,32.913l-0.863-0.943c-0.168,0.148-0.291,0.285-0.369,0.408c-0.078,0.123-0.117,0.245-0.117,0.364c0,0.156,0.054,0.287,0.163,0.393c0.109,0.106,0.244,0.159,0.408,0.159c0.117,0,0.24-0.031,0.369-0.093C49.464,33.138,49.601,33.042,49.745,32.913z M49.368,30.899l0.172-0.143c0.122-0.1,0.215-0.201,0.28-0.303c0.065-0.102,0.097-0.201,0.097-0.296c0-0.129-0.042-0.234-0.126-0.315c-0.084-0.08-0.194-0.12-0.331-0.12c-0.154,0-0.274,0.042-0.362,0.126c-0.088,0.084-0.132,0.199-0.132,0.345c0,0.058,0.018,0.132,0.055,0.22c0.036,0.088,0.083,0.164,0.139,0.23L49.368,30.899z"></path>
              <path d="M61.775,34.186h-1.364l-0.314-2.314c-0.022-0.163-0.042-0.345-0.06-0.545c-0.018-0.2-0.035-0.418-0.049-0.654c-0.034,0.227-0.101,0.509-0.201,0.848c-0.022,0.07-0.038,0.123-0.047,0.157l-0.728,2.508h-0.972l-0.727-2.508c-0.01-0.034-0.024-0.087-0.044-0.157c-0.102-0.339-0.169-0.62-0.201-0.844c-0.015,0.202-0.032,0.402-0.051,0.601c-0.019,0.199-0.043,0.397-0.069,0.594l-0.315,2.314h-1.356l0.826-5.352h1.444l0.808,2.76c0.005,0.02,0.015,0.051,0.029,0.095c0.076,0.246,0.123,0.457,0.142,0.632c0.01-0.095,0.028-0.201,0.055-0.316c0.027-0.116,0.063-0.255,0.11-0.419l0.815-2.753h1.448L61.775,34.186z"></path>
              <path d="M62.529,28.834h1.455v2.603c0,0.383,0.01,0.657,0.029,0.825c0.02,0.167,0.052,0.306,0.099,0.419c0.056,0.136,0.154,0.241,0.293,0.312c0.139,0.072,0.308,0.108,0.508,0.108c0.2,0,0.369-0.036,0.506-0.108c0.138-0.072,0.236-0.176,0.294-0.312c0.046-0.112,0.079-0.252,0.099-0.419c0.02-0.167,0.029-0.442,0.029-0.825v-0.366v-2.237h1.451v2.83c0,0.587-0.035,1.02-0.106,1.299c-0.071,0.279-0.19,0.517-0.358,0.715c-0.183,0.217-0.434,0.379-0.753,0.488c-0.319,0.109-0.707,0.163-1.163,0.163c-0.458,0-0.846-0.054-1.164-0.163c-0.318-0.108-0.57-0.271-0.755-0.488c-0.166-0.197-0.285-0.436-0.357-0.715c-0.072-0.279-0.108-0.712-0.108-1.299v-0.556V28.834z"></path>
              <path d="M68.637,32.456c0.217,0.246,0.431,0.43,0.642,0.552c0.211,0.122,0.421,0.183,0.631,0.183c0.195,0,0.355-0.052,0.481-0.157c0.125-0.105,0.188-0.238,0.188-0.398c0-0.178-0.054-0.315-0.163-0.411c-0.109-0.096-0.354-0.196-0.737-0.298c-0.524-0.141-0.894-0.325-1.111-0.552c-0.217-0.227-0.325-0.537-0.325-0.932c0-0.512,0.171-0.929,0.513-1.252c0.342-0.323,0.787-0.484,1.333-0.484c0.295,0,0.574,0.039,0.839,0.119c0.264,0.079,0.515,0.199,0.751,0.36l-0.457,1.049c-0.166-0.142-0.336-0.248-0.51-0.32c-0.174-0.072-0.347-0.108-0.517-0.108c-0.176,0-0.318,0.042-0.428,0.126c-0.11,0.084-0.165,0.192-0.165,0.324c0,0.134,0.048,0.241,0.144,0.322c0.096,0.081,0.282,0.157,0.558,0.23c0.017,0.005,0.039,0.011,0.066,0.018c0.595,0.161,0.986,0.338,1.173,0.53c0.127,0.131,0.223,0.289,0.289,0.473c0.066,0.184,0.099,0.388,0.099,0.613c0,0.568-0.186,1.024-0.56,1.369c-0.373,0.345-0.87,0.517-1.492,0.517c-0.373,0-0.712-0.063-1.018-0.19s-0.6-0.325-0.883-0.596L68.637,32.456z"></path>
              <path d="M72.787,34.186v-5.352h1.473v5.352H72.787z"></path>
              <path d="M78.371,33.062c-0.095,0.02-0.194,0.031-0.299,0.031c-0.001,0-0.002,0-0.002,0l-0.001,0v0c-0.411-0.001-0.746-0.148-1.006-0.442c-0.261-0.295-0.391-0.671-0.391-1.129c0-0.451,0.132-0.826,0.397-1.124c0.264-0.297,0.597-0.447,1-0.447v-0.003c0.495,0,0.932,0.232,1.221,0.589l0.813-0.997c-0.001-0.001-0.001-0.002-0.002-0.002c-0.268-0.263-0.578-0.466-0.93-0.608c-0.352-0.142-0.718-0.214-1.099-0.214c-0.383,0-0.749,0.071-1.098,0.214c-0.35,0.142-0.657,0.345-0.923,0.608c-0.275,0.266-0.484,0.567-0.627,0.905c-0.143,0.338-0.214,0.698-0.214,1.08c0,0.38,0.071,0.74,0.214,1.078c0.142,0.339,0.351,0.641,0.627,0.907c0.266,0.263,0.573,0.466,0.923,0.608c0.35,0.143,0.716,0.214,1.098,0.214c0.378,0,0.742-0.071,1.093-0.214c0.351-0.142,0.663-0.345,0.936-0.608c0.001-0.001,0.001-0.002,0.002-0.002l-0.814-0.998C79.061,32.786,78.742,32.99,78.371,33.062z"></path>
            </g>
          </g>
        </svg>
      </a>
    </h1>
    <div class="login">
      <h2 v-show="!isLogin">
        <a href="javascript:;" @click="openLogin">Login</a>
        <a href="javascript:;" @click="openRister">Register</a>
      </h2>
      <h2 v-show="isLogin">
        <a href="javascript:;" v-text="nikeName"></a>
        <a href="javascript:;" @click="logOut">退出</a>
      </h2>
    </div>
    <div class="md-modal modal-msg md-modal-transition  " :class="{'md-show':isClose}">
      <div class="md-modal-inner">
        <div class="md-top">
          <div class="md-title">Login in</div>
          <button class="md-close" @click="close">"Close"</button>
        </div>
        <div class="md-content">
          <div class="confirm-tips">
            <div class="error-wrap">
              <span class="error error-show" style="display: none;" v-show="errorTip">用户名或者密码错误</span>
            </div>
            <ul>
              <li class="regi_form_input">
                <i class="icon IconPeople"></i>
                <input type="text" name="loginname"
                       class="regi_login_input regi_login_input_left"
                       v-model="userName"
                >
              </li>
              <li class="regi_form_input noMargin">
                <i class="icon IconPwd"></i>
                <input type="password" name="password"
                       class="regi_login_input regi_login_input_left login-input-no input_text"
                       v-model="userPwd" @keyup.enter="login"
                >
              </li>
            </ul>
          </div>
          <div class="error-wrap">
            <a href="javascript:;" class="btn-login" @click="login"> 登  录 </a>
          </div>
        </div>
      </div>
    </div>
    <div class="md-overlay" v-if="isClose " @click="close"></div>
    <div class="md-overlay" v-if="isRegister " @click="close"></div>
    <div class="md-modal modal-msg md-modal-transition" :class="{'md-show':isRegister}">
      <div class="md-modal-inner">
        <div class="md-top">
          <div class="md-title">Register</div>
          <button class="md-close" @click="close">"Close"</button>
        </div>
        <div class="md-content">
          <div class="confirm-tips">
            <ul>
              <li class="regi_form_input">
                <i class="icon IconPeople"></i>
                <input type="text" name="loginname"
                       class="regi_login_input regi_login_input_left"
                       v-model="userName"
                >
              </li>
              <li class="regi_form_input noMargin">
                <i class="icon IconPwd"></i>
                <input type="password" name="password"
                       class="regi_login_input regi_login_input_left login-input-no input_text"
                       v-model="userPwd"
                >
              </li>
            </ul>
          </div>
          <div class="error-wrap">
            <a href="javascript:;" class="btn-login" @click="register"> 注册 </a>
          </div>
        </div>
      </div>
    </div>

  </header>
</template>
<script type="text-ecamscript-6">
  import axios from 'axios'
  export default{
    props:{
      toShop:{
        type: Boolean,
        default: false
      }
    },
    data(){
      return {
        userName:'',
        userPwd:'',
        errorTip:false,
        isRegister: false,
        isClose: false,
        isLogin: false,
        nikeName:''
      }
    },
    mounted(){
      this.checkLogin()
      console.log(this.toShop)
    },
    methods:{
      checkLogin(){
        axios.get('/users/checkLogin').then((response)=>{
          let res = response.data
          if(res.status =='0'){
            this.isLogin = true
            this.nikeName = res.result
          }
        })
      },
      login(){
        if(!this.userName || !this.userPwd){
          this.errorTip = true
          return
        }
        axios.post('/users/login',{
            userName: this.userName,
            userPwd: this.userPwd
        }).then((response)=>{
            let res = response.data
            console.log(res.result)
            if(res.status=='0'){
              this.errorTip = false
              this.isClose = false
              this.nikeName = res.result.userName
              this.isLogin= true
            }else{
              this.errorTip = true
            }
        })
      },
      logOut(){
        axios.post('/users/logout').then((response)=>{
          let res = response.data
          if(res.status=='0'){
            this.nikeName = ''
            this.isLogin= false

          }
        })
      },
      openLogin(){
        this.isClose = true
        this.$emit('listenToChildEvent',"向父组件传送数据")
      },
      openRister(){
        this.isRegister = true
      },
      close(){
        this.isClose = false
        this.isRegister = false
      },
      register(){
        axios.post('/users/register',{
            userName: this.userName,
            userPwd: this.userPwd
        }).then((response)=>{
            let res = response.data
            if(res.status=='0'){
              this.isRegister = false
            }
        })

      }
    }
  }
</script>
<style>
  .header{
    position: absolute;
    z-index: 99;
    width:100%;
    height: 80px;
  }
  .header-shop{
    background:#dcded3;
  }
  .loadMore{
    height:100px;
    line-height: 100px;
    text-align: center;
  }
  .logo{
    float: left;
    height: 80px;
    line-height: 80px;
  }
  .logo svg{
    padding-left: 42px;
    width: 98px;
    height: 80px;
    fill: #fff;
  }
  .login {
    float: right;
    padding-right: 25px;
    width: 200px;
    height: 80px;
  }
  .login a{
    display: inline-block;
    width: 80px;
    height: 68px;
    color: #f0f0f0;
    text-align: center;
    font: bold 20px/68px "微软雅黑";
  }
  .login a:hover{
    color: rgba(242,258,211,.6);
  }


</style>

